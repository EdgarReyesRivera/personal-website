---
// src/pages/projects/index.astro
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

// Get the 'status' from the URL query, e.g., /projects?status=Completed
const statusFilter = Astro.url.searchParams.get('status');

const allProjects = (await getCollection('projects')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

// Filter projects if a status is provided, otherwise show all
const filteredProjects = statusFilter
	? allProjects.filter((project) => project.data.status === statusFilter)
	: allProjects;

const allStatuses = ['Completed', 'In-Progress', 'Future'];
---

<BaseLayout
	title="Projects | Edgar Reyes-Rivera"
	description="Showcase of technical projects by Edgar Reyes-Rivera."
>
	<section>
		<h1>My Projects</h1>
		<p>
			A collection of my technical case studies, from hardware design to
			full-stack software.
		</p>

		<nav class="filter-nav">
			<a href="/projects" class:list={{ active: !statusFilter }}>All</a>
			{
				allStatuses.map((status) => (
					<a
						href={`/projects?status=${status}`}
						class:list={{ active: status === statusFilter }}
					>
						{status}
					</a>
				))
			}
		</nav>

		<ul class="project-grid">
			{
				filteredProjects.map((project) => (
					<li class="project-card">
						<a href={`/projects/${project.id}/`}>
							{project.data.heroImage && (
								<Image
									width={720}
									height={360}
									src={project.data.heroImage}
									alt={`Hero image for ${project.data.title}`}
									class="card-image"
								/>
							)}
							<div class="card-content">
								<h3 class="title">{project.data.title}</h3>
								<p class="status">{project.data.status}</p>
								<p class="description">{project.data.description}</p>
							</div>
						</a>
					</li>
				))
			}
		</ul>
	</section>
</BaseLayout>

<style>
	.filter-nav {
		display: flex;
		gap: 1rem;
		margin-bottom: 2rem;
	}
	.filter-nav a {
		padding: 0.5rem 1rem;
		border-radius: 8px;
		text-decoration: none;
		font-weight: 500;
		background-color: var(--code-bg);
		color: var(--font-color);
		transition: background-color 0.2s ease;
	}
	.filter-nav a:hover {
		background-color: var(--accent-color);
		color: var(--ghost-white);
	}
	/* Style for the active filter */
	.filter-nav a.active {
		background-color: var(--accent-dark);
		color: var(--ghost-white);
		font-weight: bold;
	}

	.project-grid {
		display: grid;
		grid-template-columns: 1fr; /* 1 column on mobile */
		gap: 2rem;
		list-style-type: none;
		margin: 0;
		padding: 0;
	}

	/* 2 columns on tablet and up */
	@media (min-width: 768px) {
		.project-grid {
			grid-template-columns: repeat(2, 1fr);
		}
	}

	.project-card {
		background-color: var(--code-bg);
		border-radius: 12px;
		overflow: hidden;
		box-shadow: 0 4px 12px rgba(var(--shadow-color), 0.1);
		transition: all 0.2s ease-in-out;
	}
	.project-card:hover {
		transform: translateY(-5px);
		box-shadow: 0 8px 20px rgba(var(--shadow-color), 0.2);
	}
	.project-card a {
		text-decoration: none;
		color: var(--font-color);
		display: block;
	}
	.card-image {
		width: 100%;
		height: 200px;
		object-fit: cover;
		border-bottom: 1px solid rgba(var(--shadow-color), 0.1);
	}
	.card-content {
		padding: 1.5rem;
	}
	.card-content .title {
		font-size: 1.5rem;
		margin: 0 0 0.5rem 0;
		color: var(--accent-dark);
	}
	.card-content .status {
		display: inline-block;
		font-size: 0.8rem;
		font-weight: bold;
		text-transform: uppercase;
		letter-spacing: 0.5px;
		padding: 0.25rem 0.75rem;
		border-radius: 99px;
		background-color: var(--accent-color);
		color: var(--ghost-white);
		margin: 0 0 1rem 0;
	}
	.card-content .description {
		font-size: 1rem;
		line-height: 1.6;
		opacity: 0.9;
	}
</style>