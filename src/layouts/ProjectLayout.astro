---
// src/layouts/ProjectLayout.astro
import type { CollectionEntry } from 'astro:content';
import BaseLayout from './BaseLayout.astro';
import FormattedDate from '../components/FormattedDate.astro';
import { Image } from 'astro:assets';

type Props = CollectionEntry<'projects'>['data'];
const { title, description, pubDate, status, heroImage, tags } = Astro.props;
---

<BaseLayout title={title} description={description} image={heroImage}>
	<article class="project-detail">
		{
			heroImage && (
				<Image
					width={1020}
					height={510}
					src={heroImage}
					alt={`Hero image for ${title}`}
					class="hero-image"
				/>
			)
		}

		<header class="project-header">
			<h1>{title}</h1>
			<p class="description">{description}</p>
		</header>

		<div class="content-wrapper">
			<div class="prose">
				<slot /> </div>

			<aside class="sidebar">
				<div class="metadata-box">
					<h3>Project Details</h3>
					<p>
						<strong>Status:</strong>
						<span class={`status-badge status-${status.toLowerCase()}`}>
							{status}
						</span>
					</p>
					<p>
						<strong>Date:</strong>
						<FormattedDate date={pubDate} />
					</p>
					{
						tags && tags.length > 0 && (
							<div class="tags-section">
								<strong>Technologies:</strong>
								<ul class="tags-list">
									{tags.map((tag) => (
										<li class="tag">{tag}</li>
									))}
								</ul>
							</div>
						)
					}
				</div>
				</aside>
		</div>
	</article>
</BaseLayout>

<style>
	.project-detail {
		max-width: 1100px;
		margin: auto;
	}
	.hero-image {
		width: 100%;
		height: auto;
		max-height: 450px;
		object-fit: cover;
		border-radius: 12px;
		margin-bottom: 2rem;
		box-shadow: var(--box-shadow);
	}
	.project-header {
		text-align: center;
		margin-bottom: 3rem;
	}
	.project-header h1 {
		font-size: 3rem;
		margin-bottom: 0.5rem;
	}
	.project-header .description {
		font-size: 1.25rem;
		color: var(--font-color);
		opacity: 0.8;
		max-width: 720px;
		margin: auto;
	}

	.content-wrapper {
		display: grid;
		grid-template-columns: 1fr;
		gap: 3rem;
	}

	/* Sidebar layout for larger screens */
	@media (min-width: 900px) {
		.content-wrapper {
			/* 3fr for content, 1fr for sidebar */
			grid-template-columns: 3fr 1fr;
		}
		.prose {
			order: 1; /* Content first */
		}
		.sidebar {
			order: 2; /* Sidebar second */
		}
	}

	/* Main content styles */
	.prose {
		color: rgb(var(--gray-dark));
	}
	/* Apply styles to the Markdown content rendered in <slot /> */
	.prose :global(h2) {
		font-size: 2rem;
		margin-top: 3rem;
		margin-bottom: 1.5rem;
		padding-bottom: 0.5rem;
		border-bottom: 2px solid rgba(var(--shadow-color), 0.2);
	}
	.prose :global(h3) {
		font-size: 1.5rem;
		margin-top: 2rem;
		margin-bottom: 1rem;
	}
	.prose :global(p) {
		font-size: 1.1rem;
		line-height: 1.8;
		margin-bottom: 1.5em;
	}
	.prose :global(img) {
		width: 100%;
		border-radius: 8px;
		box-shadow: 0 4px 12px rgba(var(--shadow-color), 0.15);
	}

	/* Sidebar styles */
	.sidebar {
		position: sticky;
		top: 2rem; /* Sticks below header */
		align-self: start; /* Aligns to top of grid cell */
	}
	.metadata-box {
		background: var(--code-bg);
		border-radius: 12px;
		padding: 1.5rem;
		border: 1px solid rgba(var(--shadow-color), 0.1);
	}
	.metadata-box h3 {
		margin-top: 0;
		border-bottom: 1px solid rgba(var(--shadow-color), 0.2);
		padding-bottom: 0.75rem;
	}
	.metadata-box p {
		margin-bottom: 1rem;
	}
	.status-badge {
		font-size: 0.9rem;
		font-weight: bold;
		padding: 0.25rem 0.75rem;
		border-radius: 99px;
		color: var(--ghost-white);
	}
	.status-completed {
		background-color: #1a8a3c;
	}
	.status-in-progress {
		background-color: #0077b5;
	}
	.status-future {
		background-color: #6a737d;
	}

	.tags-section {
		margin-top: 1.5rem;
	}
	.tags-list {
		list-style-type: none;
		padding: 0;
		margin: 0.5rem 0 0 0;
		display: flex;
		flex-wrap: wrap;
		gap: 0.5rem;
	}
	.tag {
		font-size: 0.85rem;
		background-color: rgba(var(--shadow-color), 0.15);
		padding: 0.25rem 0.75rem;
		border-radius: 6px;
	}
</style>